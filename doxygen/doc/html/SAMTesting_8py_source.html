<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>icub-client: /home/travis/build/robotology/icub-hri/src/modules/SAM/SAM_Core/SAMTesting.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">icub-client
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_ddb4d7e95cc2d6c8e1ade10a20d7247d.html">modules</a></li><li class="navelem"><a class="el" href="dir_c58165d7c2f326e33de0f6c7df0ba009.html">SAM</a></li><li class="navelem"><a class="el" href="dir_453316a4ffa88d6295915dc99dbb1a4e.html">SAM_Core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SAMTesting.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SAMTesting_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceSAM_1_1SAM__Core_1_1SAMTesting.html">    1</a></span>&#160;<span class="comment"># &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># The University of Sheffield</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"># WYSIWYD Project</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># A class includes the different testing methods implemented</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># Currently tested only with Actions</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># Created on 20 July 2016</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># @author: Daniel Camilleri, Andreas Damianou</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">from</span> IPython.display <span class="keyword">import</span> clear_output</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">from</span> sklearn.mixture <span class="keyword">import</span> GMM</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceSAM_1_1SAM__Core.html">SAM.SAM_Core</a> <span class="keyword">import</span> SAM_utils <span class="keyword">as</span> utils</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">import</span> ipyparallel <span class="keyword">as</span> ipp</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">import</span> time</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">import</span> matplotlib</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;matplotlib.use(<span class="stringliteral">&quot;TkAgg&quot;</span>)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">import</span> numpy.matlib</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">import</span> sys</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">import</span> copy</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">import</span> psutil</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">import</span> timeit</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">from</span> collections <span class="keyword">import</span> Mapping, Container</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">from</span> sys <span class="keyword">import</span> getsizeof</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">from</span> operator <span class="keyword">import</span> gt</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">import</span> logging</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="namespaceSAM_1_1SAM__Core_1_1SAMTesting.html#a338c6277ec5c82cbb28b23746c91dab4">   32</a></span>&#160;np.set_printoptions(threshold=np.nan, precision=2)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"># thisModel = None</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga4030a4fb35c568869122103d29b6cc25">deep_getsizeof</a>(o, ids):</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">    Method to calculate the size of an object `o` in bytes.</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral">        o: Object to calculate the size of.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral">        ids: Set of ids to not consider when calculating the size of the object.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral">        Size of object in bytes.</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga4030a4fb35c568869122103d29b6cc25">   52</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    d = deep_getsizeof</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> id(o) <span class="keywordflow">in</span> ids:</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">return</span> 0</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    r = getsizeof(o)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    ids.add(id(o))</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> isinstance(o, str) <span class="keywordflow">or</span> isinstance(0, unicode):</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">return</span> r</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">if</span> isinstance(o, Mapping):</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">return</span> r + sum(d(k, ids) + d(v, ids) <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> o.iteritems())</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> isinstance(o, Container):</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">return</span> r + sum(d(x, ids) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> o)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> <span class="stringliteral">&#39;SAM&#39;</span> <span class="keywordflow">in</span> o.__class__.__name__:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        total = 0</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">for</span> attr, value <span class="keywordflow">in</span> o.__dict__.iteritems():</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="comment"># logging.info(attr</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            total += d(value, ids)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">return</span> r + total</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">return</span> r</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga451f7ba20c084a7482fc4bab4ba0f59d">calibrateModelRecall</a>(thisModel):</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">    Logic to initialise calibration of model recall in order to recognize known from unknown instances.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">        thisModel: SAMObject model to calibrate.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="stringliteral">        None</span></div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga451f7ba20c084a7482fc4bab4ba0f59d">   87</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> len(thisModel) &gt; 1:</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="group__icubclient__SAM__Tests.html#ga609a55c3b5bbf9ab1f9759c240aefd8e">calibrateMultipleModelRecall</a>(thisModel)</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">elif</span> hasattr(thisModel[0], <span class="stringliteral">&#39;allDataDict&#39;</span>):</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        logging.info(<span class="stringliteral">&#39;calibrating model&#39;</span>)</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="group__icubclient__SAM__Tests.html#ga9c6b9bfe733e2ff320995ec7e0ee9cdf">calibrateSingleModelRecall</a>(thisModel)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        logging.warning(<span class="stringliteral">&#39;no calibration&#39;</span>)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga9c6b9bfe733e2ff320995ec7e0ee9cdf">calibrateSingleModelRecall</a>(thisModel):</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">    Perform calibration for single model implementations.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral">    This method either uses the bhattacharyya distance to perform calibration of known and unknown or uses histograms to use the histogram distribution of known and unknown labels in the training data to carry out the classification. This method depends on the following parameters present in config.ini. \n</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">    1) __useMaxDistance__ : `False` or `True`. This enables the use of bhattacharyya distance method to recognise known and unknown. \n</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">    2) __calibrateUnknown__ : `True` or `False`. This turns on or off the calibration of the model for known and unknown inputs. \n</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral">    3) __noBins__ : Integer number of bins to be used for the histogram method if __calibrateUnknown__ is `True` and __useMaxDistance__ is `False`. \n</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">    4) __method__ : String indicating the method used when histograms are used for calibration. When using histograms, the multi-dimensional probability of known and unknown are both calculated using the histogram. `sumProb` then performs a decision based on the largest sum after summing the probabilities of known and unknown independently. `mulProb` performs a decision based on the largest sum after multiplying the probabilities of known and unknown independently.\n</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral">        thisModel: SAMObject model to calibrate.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="stringliteral">        None</span></div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga9c6b9bfe733e2ff320995ec7e0ee9cdf">  113</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    yCalib = <a class="code" href="group__icubclient__SAM__Tests.html#ga5edddf8683ce4a2650429c355e4dd7dd">formatDataFunc</a>(thisModel[0].allDataDict[<span class="stringliteral">&#39;Y&#39;</span>])</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    logging.info(<span class="stringliteral">&#39;entering segment testing&#39;</span>)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    labelList, confMatrix, ret, variancesKnown, variancesUnknown = <a class="code" href="group__icubclient__SAM__Tests.html#ga3a78ca830aeec689bb106d1af35c2411">segmentTesting</a>(thisModel, yCalib,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                                                                  thisModel[0].allDataDict[<span class="stringliteral">&#39;L&#39;</span>],</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                                                                  thisModel[0].verbose, <span class="stringliteral">&#39;calib&#39;</span>,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                                                                  serialMode=<span class="keyword">False</span>,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                                                                  optimise=thisModel[0].optimiseRecall,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                                                                  calibrate=<span class="keyword">True</span>)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    thisModel[0].classificationDict = dict()</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> thisModel[0].useMaxDistance:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        [mk, vk, rk] = utils.meanVar_varianceDistribution(variancesKnown)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        [muk, vuk, ruk] = utils.meanVar_varianceDistribution(variancesUnknown)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        distance = []</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(mk)):</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            distance.append(utils.bhattacharyya_distance(mk[j], muk[j], vk[j], vuk[j]))</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">if</span> distance <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            maxIdx = distance.index(max(distance))</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;bestDistanceIDX&#39;</span>] = maxIdx</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;bestDistance_props&#39;</span>] = {<span class="stringliteral">&#39;KnownMean&#39;</span>: mk[maxIdx], <span class="stringliteral">&#39;UnknownMean&#39;</span>: muk[maxIdx],</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                                                 <span class="stringliteral">&#39;KnownVar&#39;</span>: vk[maxIdx], <span class="stringliteral">&#39;UnknownVar&#39;</span>: vuk[maxIdx]}</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment"># if maxIdx &lt; len(mk) - 2:</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">#     thisModel[0].bestSegOperation = maxIdx</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment"># elif maxIdx == len(mk) - 2:</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">#     thisModel[0].bestSegOperation = &#39;sum&#39;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment"># elif maxIdx == len(mk) - 1:</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">#     thisModel[0].bestSegOperation = &#39;mean&#39;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        intersection = utils.solve_intersections(mk[maxIdx], muk[maxIdx], np.sqrt(vk[maxIdx]), np.sqrt(vuk[maxIdx]))</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        maxLim = max(rk[maxIdx][1], ruk[maxIdx][1])</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        minLim = min(rk[maxIdx][0], ruk[maxIdx][0])</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        delList = []</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(intersection)):</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordflow">if</span> intersection[j] &gt; maxLim <span class="keywordflow">or</span> intersection[j] &lt; minLim:</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                delList.append(j)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;segIntersections&#39;</span>] = np.delete(intersection, delList)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;bhattaDistances&#39;</span>] = distance</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        logging.info(<span class="stringliteral">&#39;Num Intersections: &#39;</span> + str(len(thisModel[0].classificationDict[<span class="stringliteral">&#39;segIntersections&#39;</span>])))</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        [thisModel[0].classificationDict[<span class="stringliteral">&#39;varianceThreshold&#39;</span>],</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;         thisModel[0].classificationDict[<span class="stringliteral">&#39;varianceDirection&#39;</span>]] = \</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <a class="code" href="group__icubclient__SAM__Tests.html#gad2632767e0112bb1762614591096bd95">calculateVarianceThreshold</a>(thisModel[0].classificationDict[<span class="stringliteral">&#39;segIntersections&#39;</span>], mk[maxIdx], muk[maxIdx],</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                       vk[maxIdx], vuk[maxIdx])</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        logging.info(<span class="stringliteral">&#39;varianceThreshold &#39;</span> + str(thisModel[0].classificationDict[<span class="stringliteral">&#39;varianceThreshold&#39;</span>]))</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        logging.info(<span class="stringliteral">&#39;varianceDirection &#39;</span> + str(thisModel[0].classificationDict[<span class="stringliteral">&#39;varianceDirection&#39;</span>]))</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        variancesKnownArray = np.asarray(variancesKnown)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        variancesUnknownArray = np.asarray(variancesUnknown)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        varianceAllArray = np.vstack([variancesKnownArray, variancesUnknownArray])</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        histKnown = [<span class="keywordtype">None</span>] * (len(variancesKnownArray[0]) - 2)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        binEdges = [<span class="keywordtype">None</span>] * (len(variancesKnownArray[0]) - 2)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        histUnknown = [<span class="keywordtype">None</span>] * (len(variancesKnownArray[0]) - 2)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;binWidth&#39;</span>] = thisModel[0].paramsDict[<span class="stringliteral">&#39;binWidth&#39;</span>]</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;method&#39;</span>] = thisModel[0].paramsDict[<span class="stringliteral">&#39;method&#39;</span>]</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        numBins = np.ceil(np.max(varianceAllArray) / thisModel[0].classificationDict[<span class="stringliteral">&#39;binWidth&#39;</span>])</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        bins = range(int(numBins))</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        bins = np.multiply(bins, thisModel[0].classificationDict[<span class="stringliteral">&#39;binWidth&#39;</span>])</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(variancesKnown[0]) - 2):</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            histKnown[j], binEdges[j] = np.histogram(variancesKnownArray[:, j], bins=bins)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            histKnown[j] = 1.0 * histKnown[j] / np.sum(histKnown[j])</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            histUnknown[j], _ = np.histogram(variancesUnknownArray[:, j], bins=bins)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            histUnknown[j] = 1.0 * histUnknown[j] / np.sum(histUnknown[j])</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;histKnown&#39;</span>] = histKnown</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;binEdgesKnown&#39;</span>] = binEdges</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        thisModel[0].classificationDict[<span class="stringliteral">&#39;histUnknown&#39;</span>] = histUnknown</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    thisModel[0].calibrated = <span class="keyword">True</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga609a55c3b5bbf9ab1f9759c240aefd8e">calibrateMultipleModelRecall</a>(thisModel):</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">        Perform calibration for multiple model implementations.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">        In contrast with calibrateSingleModelRecall, in this method known and unknown are calibrated according to measures of familiarity between all model classes. The familiarity of each class with each other class and with itself are then used to perform a Bayesian decision depending on the resulting familiarity when testing a new instance.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral">        Args:</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral">            SAMObject model to calibrate.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">        Returns:</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="stringliteral">            None</span></div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga609a55c3b5bbf9ab1f9759c240aefd8e">  208</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    cmSize = len(thisModel[0].textLabels)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    confMatrix = np.zeros((cmSize, cmSize))</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment"># Create Validation set</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    Y_valid = []</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    Y_testing = []</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(thisModel)):</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> thisModel[i].SAMObject.model:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="comment"># De-normalize from the model which stored this test data</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            yy_test = thisModel[i].Ytestn.copy()</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            yy_test *= thisModel[i].Ystd</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            yy_test += thisModel[i].Ymean</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            y_valid_tmp, y_test_tmp, _, _ = utils.random_data_split(yy_test, [0.5, 0.5])</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            Y_valid.append(y_valid_tmp.copy())</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            Y_testing.append(y_test_tmp.copy())</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment"># Compute familiarities in VALIDATION SET</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    familiarities = [<span class="keywordtype">None</span>] * (len(thisModel) - 1)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(thisModel)):</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">if</span> thisModel[i].SAMObject.model:</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="comment"># N_test x N_labels matrix.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            familiarities[i - 1] = np.zeros((Y_valid[i - 1].shape[0], (len(thisModel) - 1)))</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            logging.info(<span class="stringliteral">&quot;## True label is &quot;</span> + thisModel[i].modelLabel)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range(Y_valid[i - 1].shape[0]):</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                sstest = []</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                logging.info(<span class="stringliteral">&#39;# k= &#39;</span> + str(k))</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(thisModel)):</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    <span class="keywordflow">if</span> thisModel[j].SAMObject.model:</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        yy_test = Y_valid[i - 1][k, :][<span class="keywordtype">None</span>, :].copy()</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        <span class="comment"># Normalize according to the model to predict</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        yy_test -= thisModel[j].Ymean</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                        yy_test /= thisModel[j].Ystd</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                        sstest.append(thisModel[j].SAMObject.familiarity(yy_test, optimise=thisModel[0].optimiseRecall))</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                        familiarities[i - 1][k, j - 1] = sstest[-1]</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                msg = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(sstest)):</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    <span class="keywordflow">if</span> j == np.argmax(sstest):</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                        msg = <span class="stringliteral">&#39;   *&#39;</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                        msg = <span class="stringliteral">&#39;    &#39;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    logging.info(msg + <span class="stringliteral">&#39;      Familiarity of model &#39;</span> + thisModel[j + 1].modelLabel + <span class="stringliteral">&#39; given label: &#39;</span> +</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                          thisModel[i].modelLabel + <span class="stringliteral">&#39; in valid: &#39;</span> + str(sstest[j]))</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                confMatrix[i - 1, np.argmax(sstest)] += 1</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="group__icubclient__SAM__Tests.html#ga7ae6c28b9d56e28c26cd320b8d321ff6">calculateData</a>(thisModel[0].textLabels, confMatrix)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment"># At this point we have:</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment"># familiarities[i][k,j] -&gt; familiarity for true label i, instance k</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">#                          predicted by model trained in label j</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment"># ############# Train Familiarity classifier in VALIDATION SET</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">#</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    classifiers = []</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    classif_thresh = []</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    familiarity_predictions = []</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    tmp = []</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(thisModel[0].textLabels)):</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        X_train = familiarities[0][:, i][:, <span class="keywordtype">None</span>]</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        y_train = np.zeros((familiarities[0][:, i][:, <span class="keywordtype">None</span>].shape[0], 1))</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(1, len(thisModel[0].textLabels)):</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            X_train = np.vstack((X_train, familiarities[j][:, i][:, <span class="keywordtype">None</span>]))</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            y_train = np.vstack((y_train, j + np.zeros((familiarities[j][:, i][:, <span class="keywordtype">None</span>].shape[0], 1))))</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        tmp.append(X_train)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        n_classes = len(np.unique(y_train))</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="comment"># Try GMMs using different types of covariances.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        classifiers.append(GMM(n_components=n_classes, covariance_type=<span class="stringliteral">&#39;full&#39;</span>, init_params=<span class="stringliteral">&#39;wc&#39;</span>, n_iter=2000))</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="comment"># Since we have class labels for the training data, we can</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment"># initialize the GMM parameters in a supervised manner.</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        classifiers[-1].means_ = np.array([X_train[y_train == kk].mean(axis=0)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                           <span class="keywordflow">for</span> kk <span class="keywordflow">in</span> xrange(n_classes)])[:, <span class="keywordtype">None</span>]</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        classifiers[-1].fit(X_train)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        familiarity_predictions.append(classifiers[-1].predict(X_train))</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment"># Find threshold of confident classification of model i predicting label i</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        tmp_i = classifiers[i].predict_proba(X_train[y_train == i][:, <span class="keywordtype">None</span>])[:, i]</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        tmp_s = 0.8</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment"># If in the test phase we get a predict_proba which falls in the threshold i, then</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment"># model i is confident for this prediction.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        classif_thresh.append([tmp_i.mean() - tmp_s * tmp_i.std(), tmp_i.mean() + tmp_s * tmp_i.std()])</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    thisModel[0].classificationDict[<span class="stringliteral">&#39;classifiers&#39;</span>] = classifiers</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    thisModel[0].classificationDict[<span class="stringliteral">&#39;classif_thresh&#39;</span>] = classif_thresh</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    thisModel[0].calibrated = <span class="keyword">True</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga5edddf8683ce4a2650429c355e4dd7dd">formatDataFunc</a>(Ydata):</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="stringliteral">        Utility function to format data for testing.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="stringliteral">        Ydata: Data to format for testing.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="stringliteral">        Formatted data for testing.</span></div><div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga5edddf8683ce4a2650429c355e4dd7dd">  304</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    yDataList = []</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(Ydata.shape[0]):</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        yDataList.append(Ydata[j][<span class="keywordtype">None</span>, :])</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">return</span> yDataList</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga08baf53ab45bde447965b03d0bfa1a35">singleRecall</a>(thisModel, testInstance, verbose, visualiseInfo=None, optimise=100):</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">        Method that performs classification for single model implementations.</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral">    </span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">        This method returns the classification label of a test instance by calculating the predictive mean and variance of the backwards mapping and subsequently decides whether the test instance is first known or unknown and if known its most probable classification label.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">        </span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">        Args:</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">            thisModel: SAMObject model to recall from.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">            testInstance: Novel feature vector to test.</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral">            verbose: Enable or disable logging to stdout.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">            visualiseInfo: None to disable plotting and plotObject to display plot of recall.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">            optimise: Number of optimisation iterations to perform during recall.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">        Returns:</span></div><div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga08baf53ab45bde447965b03d0bfa1a35">  326</a></span>&#160;<span class="stringliteral">            Classification label and variance if __calibrateUnknown__ is set to `False` in the config file. Otherwise returns classification label and normalised classification probability.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment"># </span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment"># mm,vv,pp=self.SAMObject.pattern_completion(testFace, visualiseInfo=visualiseInfo)</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment"># if verbose:</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment"># logging.info(&#39;single model recall&#39;</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    textStringOut = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment"># normalize incoming data</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    testValue = testInstance - thisModel.Ymean</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    testValue /= thisModel.Ystd</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        ret = thisModel.SAMObject.pattern_completion(testValue, visualiseInfo=visualiseInfo, optimise=optimise)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">except</span> IndexError:</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> [<span class="stringliteral">&#39;unknown&#39;</span>, 0]</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    mm = ret[0]</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    vv = list(ret[1][0])</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    svv = sum(vv)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    mvv = svv/len(vv)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    vv.append(svv)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    vv.append(mvv)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment"># find nearest neighbour of mm and SAMObject.model.X</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    k = np.matlib.repmat(mm[0].values, thisModel.SAMObject.model.X.mean.shape[0], 1)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    pow2 = np.power(thisModel.SAMObject.model.X.mean - k, 2)</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    s = np.power(np.sum(pow2, 1), 0.5)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    nn = np.argmin(s)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    min_value = s[nn]</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> thisModel.SAMObject.type == <span class="stringliteral">&#39;mrd&#39;</span>:</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        classLabel = thisModel.textLabels[int(thisModel.SAMObject.model.bgplvms[1].Y[nn, :])]</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">elif</span> thisModel.SAMObject.type == <span class="stringliteral">&#39;bgplvm&#39;</span>:</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        classLabel = thisModel.textLabels[int(thisModel.L[nn, :])]</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    known = <span class="keyword">True</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">if</span> thisModel.calibrated:</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">if</span> thisModel.useMaxDistance:</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            known = utils.varianceClass(thisModel.classificationDict[<span class="stringliteral">&#39;varianceDirection&#39;</span>],</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                vv[thisModel.classificationDict[<span class="stringliteral">&#39;bestDistanceIDX&#39;</span>]],</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                thisModel.classificationDict[<span class="stringliteral">&#39;varianceThreshold&#39;</span>])</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            details = str(thisModel.classificationDict[<span class="stringliteral">&#39;varianceThreshold&#39;</span>]) + <span class="stringliteral">&#39; &#39;</span> + \</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                      str(thisModel.classificationDict[<span class="stringliteral">&#39;varianceDirection&#39;</span>])</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            probClass = vv[thisModel.classificationDict[<span class="stringliteral">&#39;bestDistanceIDX&#39;</span>]]</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            P_Known_given_X = utils.PfromHist(vv[:-2], thisModel.classificationDict[<span class="stringliteral">&#39;histKnown&#39;</span>],</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                              thisModel.classificationDict[<span class="stringliteral">&#39;binWidth&#39;</span>])</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            P_Unknown_given_X = utils.PfromHist(vv[:-2], thisModel.classificationDict[<span class="stringliteral">&#39;histUnknown&#39;</span>],</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                                thisModel.classificationDict[<span class="stringliteral">&#39;binWidth&#39;</span>])</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <span class="keywordflow">if</span> thisModel.classificationDict[<span class="stringliteral">&#39;method&#39;</span>] == <span class="stringliteral">&#39;mulProb&#39;</span>:</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                s1 = reduce(<span class="keyword">lambda</span> x, y: x * y, P_Known_given_X)</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                s2 = reduce(<span class="keyword">lambda</span> x, y: x * y, P_Unknown_given_X)</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                known = s1 &gt; s2</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                s1 = np.sum(P_Known_given_X)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                s2 = np.sum(P_Unknown_given_X)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                known = s1 &gt; s2</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">if</span> known:</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                probClass = s1</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                details = s1, <span class="stringliteral">&#39; &gt; &#39;</span>, s2</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                probClass = s2</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                details = s2, <span class="stringliteral">&#39; &gt; &#39;</span>, s1</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> thisModel.calibrated:</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">if</span> known:</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            textStringOut = classLabel</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            textStringOut = <span class="stringliteral">&#39;unknown&#39;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            runnerUp = classLabel</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        textStringOut = classLabel</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">if</span> thisModel.calibrated:</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordflow">if</span> textStringOut == <span class="stringliteral">&#39;unknown&#39;</span>:</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                logging.info(<span class="stringliteral">&quot;With &quot;</span> + str(probClass) + <span class="stringliteral">&quot; prob. error the new instance is &quot;</span> + str(runnerUp))</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                logging.info(<span class="stringliteral">&#39;But &#39;</span> + str(details) + <span class="stringliteral">&#39; than &#39;</span> + str(probClass) + <span class="stringliteral">&#39; so class as &#39;</span> + str(textStringOut))</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                logging.info(<span class="stringliteral">&quot;With &quot;</span> + str(probClass) + <span class="stringliteral">&quot; prob. error the new instance is &quot;</span> + str(textStringOut))</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            logging.info(<span class="stringliteral">&quot;With &quot;</span> + str(vv) + <span class="stringliteral">&quot; prob. error the new instance is &quot;</span> + str(textStringOut))</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> thisModel.calibrated:</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">return</span> [textStringOut, probClass/len(vv)]</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">return</span> [textStringOut, vv]</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#gae7639430f294ed485cb2ea03a9bb5095">multipleRecall_noCalib</a>(thisModel, testInstance, verbose, visualiseInfo=None, optimise=True):</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="stringliteral">    Method that performs classification for uncalibrated multiple model implementations.</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="stringliteral">    </span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="stringliteral">        thisModel: SAMObject model to recall from.</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="stringliteral">        testInstance: Novel feature vector to test.</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="stringliteral">        verbose: Enable or disable logging to stdout.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="stringliteral">        visualiseInfo: None to disable plotting and plotObject to display plot of recall.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="stringliteral">        optimise: Number of optimisation iterations to perform during recall.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="stringliteral">        Classification label and raw familiarity values.</span></div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#gae7639430f294ed485cb2ea03a9bb5095">  432</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    result = []</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment"># logging.info(&#39;multiple model recall&#39;</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> thisModel:</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> j.SAMObject.model:</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            tempTest = testInstance - j.Ymean</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            tempTest /= j.Ystd</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            yy_test = j.SAMObject.familiarity(tempTest, optimise=optimise)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                logging.info(<span class="stringliteral">&#39;Familiarity with &#39;</span> + j.modelLabel + <span class="stringliteral">&#39; given current instance is: &#39;</span> + str(yy_test))</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="comment"># yy_test -= thisModel[j].Ymean</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="comment"># yy_test /= thisModel[j].Ystd</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            result.append(yy_test)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    maxIdx = np.argmax(result)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> visualiseInfo:</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">return</span> [thisModel[0].textLabels[maxIdx - 1], result[maxIdx][0]]</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga684e61ac3df13fa4ae0d20ed03a9979f">multipleRecall</a>(thisModel, testInstance, verbose, visualiseInfo=None, optimise=100):</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="stringliteral">    Method that performs classification for calibrated multiple model implementations.</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="stringliteral">        thisModel: SAMObject model to recall from.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="stringliteral">        testInstance: Novel feature vector to test.</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="stringliteral">        verbose: Enable or disable logging to stdout.</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="stringliteral">        visualiseInfo: None to disable plotting and plotObject to display plot of recall.</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="stringliteral">        optimise: Number of optimisation iterations to perform during recall.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="stringliteral">        Classification label and calibrated familiarity values.</span></div><div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga684e61ac3df13fa4ae0d20ed03a9979f">  469</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    cmSize = len(thisModel[0].textLabels)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    familiarities_tmp = []</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    classif_tmp = []</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    label = <span class="stringliteral">&#39;unknown&#39;</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> thisModel[0].classificationDict[<span class="stringliteral">&#39;classifiers&#39;</span>]:</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="group__icubclient__SAM__Tests.html#ga609a55c3b5bbf9ab1f9759c240aefd8e">calibrateMultipleModelRecall</a>(thisModel)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(cmSize):</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        tempTest = testInstance - thisModel[j + 1].Ymean</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        tempTest /= thisModel[j + 1].Ystd</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        yy_test = thisModel[j + 1].SAMObject.familiarity(tempTest, optimise=optimise)[:, <span class="keywordtype">None</span>]</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="comment"># yy_test *= thisModel[j+1].Ystd</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="comment"># yy_test += thisModel[j+1].Ymean</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        cc = thisModel[0].classificationDict[<span class="stringliteral">&#39;classifiers&#39;</span>][j].predict_proba(yy_test)[:, j]</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            logging.info(<span class="stringliteral">&#39;Familiarity with &#39;</span> + thisModel[j + 1].modelLabel + <span class="stringliteral">&#39; given current instance is: &#39;</span> +</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                         str(yy_test) + <span class="stringliteral">&#39; &#39;</span> + str(cc[0]))</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        familiarities_tmp.append(yy_test)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        classif_tmp.append(cc)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    bestConfidence = np.argmax(classif_tmp)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(cmSize):</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">if</span> thisModel[0].classificationDict[<span class="stringliteral">&#39;classif_thresh&#39;</span>][j][0] &lt;= \</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                classif_tmp[j] &lt;= thisModel[0].classificationDict[<span class="stringliteral">&#39;classif_thresh&#39;</span>][j][1]:</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            bestConfidence = j</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            label = thisModel[0].textLabels[j]</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="comment"># logging.info(&#39;min, classifier, max = &#39; + str(thisModel[0].classif_thresh[j][0]) + \</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="comment">#       &#39; &#39; + str(classif_tmp[j]) + &#39; &#39; + \</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="comment">#       str(thisModel[0].classif_thresh[j][1])</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment"># if visualiseInfo:</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">#     pass</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">return</span> [label, classif_tmp[bestConfidence][0]]</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#gaa209fbf7add0cf59bd93a76f0387d343">wait_watching_stdout</a>(ar, dt=1, truncate=1000):</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="stringliteral">    Monitoring function that logs to stdout the logging output of multiple threads.</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="stringliteral">        ar: Thread to log.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="stringliteral">        dt: Integer delta time between readings of ar.stdout.</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="stringliteral">        truncate: Integer limit on the number of lines returned by the threads.</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="stringliteral">        None</span></div><div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#gaa209fbf7add0cf59bd93a76f0387d343">  521</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">while</span> <span class="keywordflow">not</span> ar.ready():</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        stdouts = ar.stdout</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">if</span> any(stdouts):</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            clear_output()</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            logging.info(<span class="stringliteral">&#39;-&#39;</span> * 30)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            logging.info(<span class="stringliteral">&quot;%.3fs elapsed&quot;</span> % ar.elapsed)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            logging.info(<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">for</span> stdout <span class="keywordflow">in</span> ar.stdout:</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <span class="keywordflow">if</span> stdout:</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    logging.info(<span class="stringliteral">&quot;\n%s&quot;</span> % (stdout[-truncate:]))</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            sys.stdout.flush()</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        time.sleep(dt)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#gaa5357ad5f4775cd411d35896655374f5">testSegment</a>(thisModel, Ysample, verbose, visualiseInfo=None, optimise=100):</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="stringliteral">    Utility function to test a sample.</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="stringliteral">    This model determines the type of model being used for the testing and directs the query to the appropriate function.</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="stringliteral">        thisModel: SAMObject model to recall from.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="stringliteral">        Ysample: Novel feature vector to test.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="stringliteral">        verbose: Enable or disable logging to stdout.</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="stringliteral">        visualiseInfo: `None` to disable plotting and plotObject to display plot of recall.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="stringliteral">        optimise: Number of optimisation iterations to perform during recall.</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="stringliteral">        Classification result containing a list with the classification string and a measure of the familiarity or probability of the recall.</span></div><div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#gaa5357ad5f4775cd411d35896655374f5">  551</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> len(thisModel) &gt; 1:</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        d = <a class="code" href="group__icubclient__SAM__Tests.html#ga684e61ac3df13fa4ae0d20ed03a9979f">multipleRecall</a>(thisModel, Ysample, verbose, visualiseInfo, optimise=optimise)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        d = <a class="code" href="group__icubclient__SAM__Tests.html#ga08baf53ab45bde447965b03d0bfa1a35">singleRecall</a>(thisModel[0], Ysample, verbose, visualiseInfo, optimise=optimise)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">return</span> d</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga3a78ca830aeec689bb106d1af35c2411">segmentTesting</a>(thisModel, Ysample, Lnum, verbose, label, serialMode=False, optimise=100, calibrate=False):</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="stringliteral">    Method to test multiple samples at a time.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="stringliteral">        thisModel : SAMObject model to recall from.</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="stringliteral">        Ysample : Novel feature vector to test.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="stringliteral">        Lnum : Ground truth labels to compare with.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="stringliteral">        verbose : Enable or disable logging to stdout.</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="stringliteral">        label : Label for the current segments being tested.</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="stringliteral">        serialMode : Boolean to test serially or in parallel.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="stringliteral">        optimise : Number of optimisation iterations to perform during recall.</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="stringliteral">        calibrate : Indicate calibration mode when True which requires a different return.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="stringliteral">        labelList, confMatrix, ret, variancesKnown, variancesUnknown if calibrate is `True`.</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="stringliteral">        labelList, confMatrix, labelComparisonDict if calibrate is `False`.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="stringliteral">        labelList : List of classification labels</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="stringliteral">        confMatrix : Numpy array with the confusion matrix</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="stringliteral">        ret : Classification object</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="stringliteral">        variancesKnown : Variances returned during calibration for known training instances</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="stringliteral">        variancesUnknown : Variances returned during calibration for unknown training instances</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="stringliteral">        labelComparisonDict : Dictionary with two items `&#39;original&#39;` and `&#39;results&#39;`.</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga3a78ca830aeec689bb106d1af35c2411">  584</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keyword">def </span>testFunc(data, lab):</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        d = <a class="code" href="group__icubclient__SAM__Tests.html#gaa5357ad5f4775cd411d35896655374f5">testSegment</a>(thisModel, data, verbose, visualiseInfo=<span class="keywordtype">None</span>, optimise=optimise)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="keywordflow">if</span> lab == d[0]:</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                res = <span class="keyword">True</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                res = <span class="keyword">False</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            logging.info(<span class="stringliteral">&#39;Actual  &#39;</span> + str(lab).ljust(11) + <span class="stringliteral">&#39;  Classification:  &#39;</span> + str(d[0]).ljust(11) + <span class="stringliteral">&#39;  with &#39;</span> + \</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                  str(d[1])[:6] + <span class="stringliteral">&#39; confidence: &#39;</span> + str(res) + <span class="stringliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> d</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    logging.info(<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> type(Lnum).__module__ == np.__name__:</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        useModelLabels = <span class="keyword">True</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        useModelLabels = <span class="keyword">False</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">if</span> len(thisModel) &gt; 1:</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        labelList = copy.deepcopy(thisModel[0].textLabels)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        labelList.append(<span class="stringliteral">&#39;unknown&#39;</span>)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        labelList = copy.deepcopy(thisModel[0].textLabels)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        labelList.append(<span class="stringliteral">&#39;unknown&#39;</span>)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    confMatrix = np.zeros((len(labelList), len(labelList)))</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    numItems = len(Ysample)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    off1 = 11</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    off2 = 8</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    off3 = len(str(numItems))</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> useModelLabels:</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        Lsample = [thisModel[0].textLabels[int(Lnum[i])] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(Lnum))]</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        Lsample = Lnum</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> numItems &lt; 1500:</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        serialMode = <span class="keyword">True</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    c = <span class="keywordtype">None</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    logging.info(<span class="stringliteral">&#39;serialMode: &#39;</span> + str(serialMode))</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> serialMode <span class="keywordflow">and</span> thisModel[0].parallelOperation:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            logging.info(<span class="stringliteral">&#39;Trying engines ...&#39;</span>)</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            c = ipp.Client()</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            numWorkers = len(c._engines)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            logging.info(<span class="stringliteral">&#39;Number of engines: &#39;</span> + str(numWorkers))</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">except</span>:</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            logging.error(<span class="stringliteral">&quot;Parallel workers not found&quot;</span>)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            thisModel[0].parallelOperation = <span class="keyword">False</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            numWorkers = 1</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        logging.info(str(serialMode) + <span class="stringliteral">&#39;= True&#39;</span>)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        thisModel[0].parallelOperation = <span class="keyword">False</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        numWorkers = 1</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        logging.info(<span class="stringliteral">&#39;Number of engines: &#39;</span> + str(numWorkers))</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment"># average 5 classifications before providing this time</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    vTemp = copy.deepcopy(verbose)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    verbose = <span class="keyword">False</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">if</span> len(Lsample) &lt; 400:</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        numTrials = len(Lsample)*0.1</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        numTrials = int(numTrials)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        numTrials = 20</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    t0 = time.time()</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(numTrials):</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        testFunc(Ysample[j], Lsample[j])</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    t1 = time.time()</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    verbose = vTemp</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    thisModel[0].avgClassTime = (t1 - t0) / numTrials</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    logging.info(<span class="stringliteral">&#39;classification rate: &#39;</span> + str(1.0 / thisModel[0].avgClassTime) + <span class="stringliteral">&#39;fps&#39;</span>)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    logging.info(<span class="stringliteral">&#39;estimated time: &#39;</span> + str(thisModel[0].avgClassTime * numItems / (60*numWorkers)) + <span class="stringliteral">&#39;mins for &#39;</span> +</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                 str(numItems) + <span class="stringliteral">&#39; items with &#39;</span> + str(numWorkers) + <span class="stringliteral">&#39; workers&#39;</span>)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    t0 = time.time()</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    logging.info(t0)</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="comment"># check size of model</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment"># modelSize is size in megabytes</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    modelSize = <a class="code" href="group__icubclient__SAM__Tests.html#ga4030a4fb35c568869122103d29b6cc25">deep_getsizeof</a>(thisModel, set()) / 1024.0 / 1024.0</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    logging.info(<span class="stringliteral">&quot;modelSize: &quot;</span> + str(modelSize))</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    logging.warning(<span class="stringliteral">&quot;required testing size: &quot;</span> + str((modelSize * numWorkers * 2) + 400) + <span class="stringliteral">&quot; MB&quot;</span>)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment"># check available system memory in megabytes</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    freeSystemMem = float(psutil.virtual_memory()[4]) / 1024.0 / 1024.0</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    logging.info(<span class="stringliteral">&quot;free memory: &quot;</span> + str(freeSystemMem) + <span class="stringliteral">&quot; MB&quot;</span>)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> modelSize &gt; 100 <span class="keywordflow">or</span> <span class="keywordflow">not</span> thisModel[0].parallelOperation <span class="keywordflow">or</span> serialMode:</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment"># serial testing</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        logging.warning(<span class="stringliteral">&#39;Testing serially&#39;</span>)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        ret = []</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(Lsample)):</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            logging.info(str(j) + <span class="stringliteral">&#39;/&#39;</span> + str(len(Lsample)))</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            ret.append(testFunc(Ysample[j], Lsample[j]))</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="comment"># parallel testing</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        logging.info(<span class="stringliteral">&#39;Testing in parallel&#39;</span>)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        dview = c[:]  <span class="comment"># not load balanced</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        lb = c.load_balanced_view()  <span class="comment"># load balanced</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="comment"># with dview.sync_imports():</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="comment">#     from SAM.SAM_Core import utils</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="comment"># if not thisModel[0].modelLoaded :</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        dview.push({<span class="stringliteral">&#39;thisModel&#39;</span>: thisModel})</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        dview.push({<span class="stringliteral">&#39;verbose&#39;</span>: verbose})</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        dview.push({<span class="stringliteral">&#39;optimise&#39;</span>: optimise})</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="comment"># thisModel[0].modelLoaded = True</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        syn = lb.map_async(testFunc, Ysample, Lsample)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <a class="code" href="group__icubclient__SAM__Tests.html#gaa209fbf7add0cf59bd93a76f0387d343">wait_watching_stdout</a>(syn, dt=1, truncate=1000)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        ret = syn.get()</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="comment"># maybe these are upsetting the ipcluster</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="comment"># dview.clear()</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment"># dview.purge_results(&#39;all&#39;)</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    t1 = time.time()</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    logging.info(t1)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    logging.info(<span class="stringliteral">&#39;Actual time taken = &#39;</span> + str(t1-t0))</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> calibrate:</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        variancesKnown = []</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        variancesUnknown = []</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(ret)):</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            currLabel = Lsample[i]</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                <span class="keywordflow">if</span> currLabel == ret[i][0]:</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                    result = <span class="keyword">True</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    result = <span class="keyword">False</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                logging.info(str(i).rjust(off3) + <span class="stringliteral">&#39;/&#39;</span> + str(numItems) + <span class="stringliteral">&#39; Truth: &#39;</span> + currLabel.ljust(off1) + <span class="stringliteral">&#39; Model: &#39;</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                             + ret[i][0].ljust(off1) + <span class="stringliteral">&#39; with &#39;</span> + str(ret[i][1])[:6].ljust(off2) +</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                             <span class="stringliteral">&#39; confidence: &#39;</span> + str(result))</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <span class="keywordflow">if</span> currLabel <span class="keywordflow">in</span> thisModel[0].textLabels:</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                knownLabel = <span class="keyword">True</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                knownLabel = <span class="keyword">False</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                currLabel = <span class="stringliteral">&#39;unknown&#39;</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordflow">if</span> knownLabel:</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                variancesKnown.append(ret[i][1])</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                variancesUnknown.append(ret[i][1])</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            confMatrix[labelList.index(currLabel), labelList.index(ret[i][0])] += 1</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">return</span> labelList, confMatrix, ret, variancesKnown, variancesUnknown</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        labelComparisonDict = dict()</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        labelComparisonDict[<span class="stringliteral">&#39;original&#39;</span>] = []</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        labelComparisonDict[<span class="stringliteral">&#39;results&#39;</span>] = []</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(ret)):</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            currLabel = Lsample[i]</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            retLabel = ret[i][0]</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordflow">if</span> currLabel <span class="keywordflow">not</span> <span class="keywordflow">in</span> thisModel[0].textLabels:</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                currLabel = <span class="stringliteral">&#39;unknown&#39;</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="keywordflow">if</span> verbose:</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="keywordflow">if</span> currLabel == retLabel:</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    result = <span class="keyword">True</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    result = <span class="keyword">False</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                logging.info(str(i).rjust(off3) + <span class="stringliteral">&#39;/&#39;</span> + str(numItems) + <span class="stringliteral">&#39; Truth: &#39;</span> + currLabel.ljust(off1) +</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                             <span class="stringliteral">&#39; Model: &#39;</span> + retLabel.ljust(off1) + <span class="stringliteral">&#39; with &#39;</span> + str(ret[i][1])[:6].ljust(off2) +</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                             <span class="stringliteral">&#39; confidence: &#39;</span> + str(result))</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            labelComparisonDict[<span class="stringliteral">&#39;original&#39;</span>].append(Lsample[i])</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            labelComparisonDict[<span class="stringliteral">&#39;results&#39;</span>].append(retLabel)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            confMatrix[labelList.index(currLabel), labelList.index(retLabel)] += 1</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">return</span> labelList, confMatrix, labelComparisonDict</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#gab4468c0fd3358f455f808f6e4a4132ea">testSegments</a>(thisModel, Ysample, Lnum, verbose, label, serialMode=False):</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral">    Function to test segments and return a confusion matrix.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="stringliteral">        thisModel : SAMObject model to recall from.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="stringliteral">        Ysample : Novel feature vector to test.</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="stringliteral">        Lnum : Ground truth labels to compare with.</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="stringliteral">        verbose : Enable or disable logging to stdout.</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="stringliteral">        label : Label for the current segments being tested.</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="stringliteral">        serialMode : Boolean to test serially or in parallel.</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="stringliteral">        Confusion matrix, confusion labels, list of possible labels and dictionary with results and comparison or truth and classification.</span></div><div class="line"><a name="l00768"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#gab4468c0fd3358f455f808f6e4a4132ea">  768</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    labelList, confMatrix, labelComparisonDict = <a class="code" href="group__icubclient__SAM__Tests.html#ga3a78ca830aeec689bb106d1af35c2411">segmentTesting</a>(thisModel, Ysample, Lnum, verbose, label,</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                                                serialMode=serialMode,</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                                                optimise=thisModel[0].optimiseRecall, calibrate=<span class="keyword">False</span>)</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    dCalc = <a class="code" href="group__icubclient__SAM__Tests.html#ga7ae6c28b9d56e28c26cd320b8d321ff6">calculateData</a>(labelList, confMatrix)</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">return</span> [dCalc[0], dCalc[1], labelList, labelComparisonDict]</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#gad2632767e0112bb1762614591096bd95">calculateVarianceThreshold</a>(segIntersections, mk, muk, vk, vuk):</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="stringliteral">    Method to decide on the approach to be used for setting variance thresholds and method of thresholding.</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="stringliteral">        segIntersections : Number of gaussian intersections.</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="stringliteral">        mk : Means of known.</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="stringliteral">        muk : Means of unknown.</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="stringliteral">        vk : Variances of known.</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="stringliteral">        vuk : Variances of unknown.</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="stringliteral">        List of threshold variances and method of thresholding.</span></div><div class="line"><a name="l00791"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#gad2632767e0112bb1762614591096bd95">  791</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    thresh = <span class="keywordtype">None</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    direction = <span class="keywordtype">None</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">if</span> len(segIntersections) == 0:</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="comment"># either gaussians exactly equal to each other(worst) or no overlap(best)</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> mk == muk:</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="comment"># gaussians on top of each other .. can only happen with 0 intersections when mean is identical</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="comment"># and var is identical</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            thresh = [mk]</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            direction = [<span class="stringliteral">&#39;smaller&#39;</span>]</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="comment"># gaussians completely separated, threshold set equidistant to means</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            thresh = [(max(mk, muk) - min(mk, muk)) / 2 + min(mk, muk)]</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordflow">if</span> thresh[0] &gt; mk:</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                direction = [<span class="stringliteral">&#39;smaller&#39;</span>]</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">elif</span> len(segIntersections) == 1:</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        thresh = [segIntersections]</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span> thresh[0] &gt; mk:</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            direction = [<span class="stringliteral">&#39;smaller&#39;</span>]</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="comment"># set threshold at this point</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">elif</span> len(segIntersections) == 2:</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">if</span> mk == muk:</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="comment"># set upper and lower bounds on threshold</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            thresh = [min(segIntersections), max(segIntersections)]</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            <span class="comment"># works</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="keywordflow">if</span> vk &gt; vuk:</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                direction = [<span class="stringliteral">&#39;smaller&#39;</span>, <span class="stringliteral">&#39;greater&#39;</span>]</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                direction = [<span class="stringliteral">&#39;greater&#39;</span>, <span class="stringliteral">&#39;smaller&#39;</span>]</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            thresh = [np.ptp(segIntersections) / 2 + min(segIntersections)]</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <span class="keywordflow">if</span> thresh[0] &lt; muk:</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                direction = [<span class="stringliteral">&#39;smaller&#39;</span>]</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                <span class="comment"># set threshold equidistant from intersection</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">if</span> direction <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        direction = [<span class="stringliteral">&#39;greater&#39;</span>]</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">return</span> [thresh, direction]</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga7ae6c28b9d56e28c26cd320b8d321ff6">calculateData</a>(textLabels, confMatrix, numItems=None):</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="stringliteral">    Calculate the normalised confusion matrix.</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="stringliteral">        textLabels: List of classifications.</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral">        confMatrix: Confusion matrix to normalise.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral">        numItems: Total number of items tested.</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="stringliteral">        Normalised confusion matrix and overall percentage correct.</span></div><div class="line"><a name="l00843"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga7ae6c28b9d56e28c26cd320b8d321ff6">  843</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    logging.info(confMatrix)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> numItems:</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        numItems = np.sum(confMatrix)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    h = confMatrix</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    total = h.astype(np.float).sum(axis=1)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    normConf = copy.deepcopy(h)</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    normConf = normConf.astype(np.float)</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">for</span> l <span class="keywordflow">in</span> range(h.shape[0]):</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">if</span> total[l] != 0:</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            normConf[l, :] = normConf[l, :].astype(np.float) * 100 / total[l].astype(np.float)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    logging.info(normConf)</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="comment"># percCorect = 100 * np.diag(h.astype(np.float)).sum() / numItems</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    percCorect = 100 * np.diag(normConf.astype(np.float)).sum() / np.sum(normConf)</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    logging.info(str(percCorect)[:5].ljust(7) + <span class="stringliteral">&quot;% correct for training data&quot;</span>)</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    logging.info(<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(confMatrix.shape[0]):</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(confMatrix.shape[0]):</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            logging.info(str(normConf[i, j])[:5].ljust(7) + <span class="stringliteral">&#39;% of &#39;</span> + str(textLabels[i]) +</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                         <span class="stringliteral">&#39; classified as &#39;</span> + str(textLabels[j]))</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        logging.info(<span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">return</span> [normConf, percCorect]</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="keyword">def </span><a class="code" href="group__icubclient__SAM__Tests.html#ga2475129eb5c2e30ffe652729e98b3fc5">combineClassifications</a>(thisModel, labels, likelihoods):</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="stringliteral">    Combine multiple classifications into a single classification.</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="stringliteral">    Args:</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="stringliteral">        thisModel: SAMObject model.</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="stringliteral">        labels: List of labels for classifications.</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="stringliteral">        likelihoods: List of likelihoods.</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="stringliteral">    Returns:</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="stringliteral">        Label with the highest likelihood together with the normalised likelihood.</span></div><div class="line"><a name="l00883"></a><span class="lineno"><a class="line" href="group__icubclient__SAM__Tests.html#ga2475129eb5c2e30ffe652729e98b3fc5">  883</a></span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment"># if len(thisModel) &gt; 1:</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">#     labelList = copy.deepcopy(thisModel[0].textLabels)</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">#     labelList.append(&#39;unknown&#39;)</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment"># else:</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    labelList = copy.deepcopy(thisModel[0].textLabels)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    sumLikelihoods = [<span class="keywordtype">None</span>] * (len(labelList))</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    counts = [0] * (len(labelList))</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(labels)):</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        idx = [j <span class="keywordflow">for</span> j, k <span class="keywordflow">in</span> enumerate(labelList) <span class="keywordflow">if</span> k == labels[i]][0]</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        counts[idx] += 1</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">if</span> sumLikelihoods[idx] <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            sumLikelihoods[idx] = likelihoods[i][thisModel[0].SAMObject.Q]</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            sumLikelihoods[idx] += likelihoods[i][thisModel[0].SAMObject.Q]</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    m = max(sumLikelihoods)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    maxIdx = [j <span class="keywordflow">for</span> j, k <span class="keywordflow">in</span> enumerate(sumLikelihoods) <span class="keywordflow">if</span> k == m][0]</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">return</span> [labelList[maxIdx], m / counts[maxIdx]]</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="ttc" id="group__icubclient__SAM__Tests_html_gaa209fbf7add0cf59bd93a76f0387d343"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#gaa209fbf7add0cf59bd93a76f0387d343">SAM.SAM_Core.SAMTesting.wait_watching_stdout</a></div><div class="ttdeci">def wait_watching_stdout(ar, dt=1, truncate=1000)</div><div class="ttdoc">Monitoring function that logs to stdout the logging output of multiple threads. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00521">SAMTesting.py:521</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga3a78ca830aeec689bb106d1af35c2411"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga3a78ca830aeec689bb106d1af35c2411">SAM.SAM_Core.SAMTesting.segmentTesting</a></div><div class="ttdeci">def segmentTesting(thisModel, Ysample, Lnum, verbose, label, serialMode=False, optimise=100, calibrate=False)</div><div class="ttdoc">Method to test multiple samples at a time. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00584">SAMTesting.py:584</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga9c6b9bfe733e2ff320995ec7e0ee9cdf"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga9c6b9bfe733e2ff320995ec7e0ee9cdf">SAM.SAM_Core.SAMTesting.calibrateSingleModelRecall</a></div><div class="ttdeci">def calibrateSingleModelRecall(thisModel)</div><div class="ttdoc">Perform calibration for single model implementations. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00113">SAMTesting.py:113</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_gab4468c0fd3358f455f808f6e4a4132ea"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#gab4468c0fd3358f455f808f6e4a4132ea">SAM.SAM_Core.SAMTesting.testSegments</a></div><div class="ttdeci">def testSegments(thisModel, Ysample, Lnum, verbose, label, serialMode=False)</div><div class="ttdoc">Function to test segments and return a confusion matrix. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00768">SAMTesting.py:768</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga2475129eb5c2e30ffe652729e98b3fc5"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga2475129eb5c2e30ffe652729e98b3fc5">SAM.SAM_Core.SAMTesting.combineClassifications</a></div><div class="ttdeci">def combineClassifications(thisModel, labels, likelihoods)</div><div class="ttdoc">Combine multiple classifications into a single classification. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00883">SAMTesting.py:883</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_gaa5357ad5f4775cd411d35896655374f5"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#gaa5357ad5f4775cd411d35896655374f5">SAM.SAM_Core.SAMTesting.testSegment</a></div><div class="ttdeci">def testSegment(thisModel, Ysample, verbose, visualiseInfo=None, optimise=100)</div><div class="ttdoc">Utility function to test a sample. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00551">SAMTesting.py:551</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_gad2632767e0112bb1762614591096bd95"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#gad2632767e0112bb1762614591096bd95">SAM.SAM_Core.SAMTesting.calculateVarianceThreshold</a></div><div class="ttdeci">def calculateVarianceThreshold(segIntersections, mk, muk, vk, vuk)</div><div class="ttdoc">Method to decide on the approach to be used for setting variance thresholds and method of thresholdin...</div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00791">SAMTesting.py:791</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_gae7639430f294ed485cb2ea03a9bb5095"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#gae7639430f294ed485cb2ea03a9bb5095">SAM.SAM_Core.SAMTesting.multipleRecall_noCalib</a></div><div class="ttdeci">def multipleRecall_noCalib(thisModel, testInstance, verbose, visualiseInfo=None, optimise=True)</div><div class="ttdoc">Method that performs classification for uncalibrated multiple model implementations. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00432">SAMTesting.py:432</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga08baf53ab45bde447965b03d0bfa1a35"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga08baf53ab45bde447965b03d0bfa1a35">SAM.SAM_Core.SAMTesting.singleRecall</a></div><div class="ttdeci">def singleRecall(thisModel, testInstance, verbose, visualiseInfo=None, optimise=100)</div><div class="ttdoc">Method that performs classification for single model implementations. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00326">SAMTesting.py:326</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga451f7ba20c084a7482fc4bab4ba0f59d"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga451f7ba20c084a7482fc4bab4ba0f59d">SAM.SAM_Core.SAMTesting.calibrateModelRecall</a></div><div class="ttdeci">def calibrateModelRecall(thisModel)</div><div class="ttdoc">Logic to initialise calibration of model recall in order to recognize known from unknown instances...</div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00087">SAMTesting.py:87</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga609a55c3b5bbf9ab1f9759c240aefd8e"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga609a55c3b5bbf9ab1f9759c240aefd8e">SAM.SAM_Core.SAMTesting.calibrateMultipleModelRecall</a></div><div class="ttdeci">def calibrateMultipleModelRecall(thisModel)</div><div class="ttdoc">Perform calibration for multiple model implementations. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00208">SAMTesting.py:208</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga5edddf8683ce4a2650429c355e4dd7dd"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga5edddf8683ce4a2650429c355e4dd7dd">SAM.SAM_Core.SAMTesting.formatDataFunc</a></div><div class="ttdeci">def formatDataFunc(Ydata)</div><div class="ttdoc">Utility function to format data for testing. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00304">SAMTesting.py:304</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga7ae6c28b9d56e28c26cd320b8d321ff6"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga7ae6c28b9d56e28c26cd320b8d321ff6">SAM.SAM_Core.SAMTesting.calculateData</a></div><div class="ttdeci">def calculateData(textLabels, confMatrix, numItems=None)</div><div class="ttdoc">Calculate the normalised confusion matrix. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00843">SAMTesting.py:843</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga684e61ac3df13fa4ae0d20ed03a9979f"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga684e61ac3df13fa4ae0d20ed03a9979f">SAM.SAM_Core.SAMTesting.multipleRecall</a></div><div class="ttdeci">def multipleRecall(thisModel, testInstance, verbose, visualiseInfo=None, optimise=100)</div><div class="ttdoc">Method that performs classification for calibrated multiple model implementations. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00469">SAMTesting.py:469</a></div></div>
<div class="ttc" id="namespaceSAM_1_1SAM__Core_html"><div class="ttname"><a href="namespaceSAM_1_1SAM__Core.html">SAM.SAM_Core</a></div><div class="ttdef"><b>Definition:</b> <a href="SAM__Core_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="group__icubclient__SAM__Tests_html_ga4030a4fb35c568869122103d29b6cc25"><div class="ttname"><a href="group__icubclient__SAM__Tests.html#ga4030a4fb35c568869122103d29b6cc25">SAM.SAM_Core.SAMTesting.deep_getsizeof</a></div><div class="ttdeci">def deep_getsizeof(o, ids)</div><div class="ttdoc">Method to calculate the size of an object o in bytes. </div><div class="ttdef"><b>Definition:</b> <a href="SAMTesting_8py_source.html#l00052">SAMTesting.py:52</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 19 2020 23:45:26 for icub-client by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
